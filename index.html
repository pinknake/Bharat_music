<!DOCTYPE html>
<html>
<head>
  <title>🎶 Upload Song</title>
</head>
<body>

  <h2>🎵 Upload Song to Firebase</h2>

  <form id="uploadForm">
    <input type="text" name="title" placeholder="Song Title" required><br><br>
    <input type="file" name="song" accept="audio/*" required><br><br>
    <button type="submit">⬆ Upload</button>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";
    import { getDatabase, ref as dbRef, push, set } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBj0MpUEF_gq2BdW1gTSQd0KCrWukRadK4",
      authDomain: "musicplayer-a6d09.firebaseapp.com",
      databaseURL: "https://musicplayer-a6d09-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "musicplayer-a6d09",
      storageBucket: "musicplayer-a6d09.appspot.com",
      messagingSenderId: "44572704031",
      appId: "1:44572704031:web:693770ba678984eee2c42a",
      measurementId: "G-MXJVZ3KMPB"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const storage = getStorage(app);
    const database = getDatabase(app);

    document.getElementById("uploadForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const title = document.querySelector('input[name="title"]').value;
      const file = document.querySelector('input[name="song"]').files[0];
      if (!title || !file) return alert("❌ Fill all fields");

      const filename = Date.now() + '_' + file.name;
      const storageRef = ref(storage, 'songs/' + filename);
      const uploadTask = uploadBytesResumable(storageRef, file);

      uploadTask.on('state_changed',
        null,
        (error) => alert("❌ Upload failed: " + error),
        () => {
          getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
            const songRef = push(dbRef(database, 'songs'));
            set(songRef, {
              title,
              url: downloadURL,
              online: true
            }).then(() => {
              alert("✅ Upload Success!");
              location.reload();
            });
          });
        }
      );
    });
  </script>
</body>
</html>
