<!DOCTYPE html>
<html>
<head>
  <title>ðŸŽ¶ Bharat Music - Upload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; padding: 20px; }
    input, button { padding: 10px; margin: 10px; width: 90%; max-width: 400px; }
    .song-box { background: white; padding: 15px; margin: 10px auto; border-radius: 10px; width: 90%; max-width: 400px; }
    audio { width: 100%; margin-top: 10px; }
  </style>
</head>
<body>

  <h2>ðŸŽµ Upload Your Song</h2>
  <input type="text" id="title" placeholder="Song Title"><br>
  <input type="file" id="audio" accept="audio/*"><br>
  <button onclick="uploadSong()">â¬† Upload to Firebase</button>

  <h2>ðŸŽ§ Songs Folder</h2>
  <div id="songs">Loading...</div>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";
    import { getDatabase, push, ref as dbRef, set, onValue } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBj0MpUEF_gq2BdW1gTSQd0KCrWukRadK4",
      authDomain: "musicplayer-a6d09.firebaseapp.com",
      databaseURL: "https://musicplayer-a6d09-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "musicplayer-a6d09",
      storageBucket: "musicplayer-a6d09.appspot.com",
      messagingSenderId: "44572704031",
      appId: "1:44572704031:web:693770ba678984eee2c42a"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getDatabase(app);

    function uploadSong() {
      const title = document.getElementById("title").value.trim();
      const file = document.getElementById("audio").files[0];
      if (!title || !file) return alert("Please enter title and choose a file");

      const storageRef = ref(storage, 'songs/' + Date.now() + '_' + file.name);

      uploadBytes(storageRef, file).then(snapshot => {
        return getDownloadURL(snapshot.ref);
      }).then(url => {
        const songRef = push(dbRef(db, 'songs'));
        set(songRef, { title, url });
        alert("âœ… Uploaded!");
        document.getElementById("title").value = "";
        document.getElementById("audio").value = "";
      }).catch(error => {
        alert("âŒ Upload failed: " + error);
      });
    }

    function loadSongs() {
      const songsDiv = document.getElementById("songs");
      const songsRef = dbRef(db, 'songs');

      onValue(songsRef, snapshot => {
        const data = snapshot.val();
        songsDiv.innerHTML = '';
        if (!data) {
          songsDiv.innerHTML = "No songs uploaded yet.";
          return;
        }

        Object.values(data).reverse().forEach(song => {
          const box = document.createElement('div');
          box.className = 'song-box';
          box.innerHTML = `<strong>${song.title}</strong><br>
                           <audio controls src="${song.url}"></audio>`;
          songsDiv.appendChild(box);
        });
      });
    }

    loadSongs();
  </script>
</body>
</html>
